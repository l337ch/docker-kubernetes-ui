function templateTransform(_,template){var stringifyNoQuotes=function(e){return"string"!=typeof e&&("undefined"!==e?(e=JSON.stringify(e),e=e.replace(/\"([^(\")"]+)\":/g,"$1:")):e="undefined"),e},evalExpression=function(item,expression){var result=void 0,expr=expression.eval;if("string"==typeof expr){var args=[];_.isArray(expression.args)&&(_.forEach(expression.args,function(e){"string"==typeof e&&("$"===e.charAt(0)&&(e=JSONPath(null,item,e)),e&&e.length>0&&(e=_.map(e,function(e){return stringifyNoQuotes(e)}),args.push(e)))}),expr=vsprintf(expr,args)),result=eval(expr)}return result},filterItem=function(e){return function(t){return _.every(e,function(e){return evalExpression(t,e)})}},mapItem=function(e,t,n){var r=function(){var e=JSON.stringify(Math.random()),t=e.indexOf(".")+1;return t>0&&t<e.length&&(e=e.substring(t)),e},i=function(e,t,n){var r=function(e,t){var n=void 0;return t&&("string"==typeof t?"$"===t.charAt(0)?(results=JSONPath(null,e,t),results&&results.length>0&&1===results.length&&(n=results[0])):n=t:"object"==typeof t?n=t.expression?evalExpression(e,t):i(e,{},t):_.isArray(t)&&(n=_.map(t,function(t){return r(e,t)}))),n};return n&&_.forOwn(n,function(n,i){n=r(e,n),n&&(i=r(e,i),i&&(i=stringifyNoQuotes(i),t[i]=n))}),t};t.id=e.id||r(),n&&_.forEach(n,function(n){(!n.filter||evalExpression(e,n.filter))&&i(e,t,n.properties)})},mapNodes=function(e,t){var n=function(e){var t={};return mapItem(e,t,template.nodeMaps),t},r=function(e){return e.id},i=_.chain(e);template.nodeFilters&&(i=i.filter(filterItem(template.nodeFilters))),t.nodes=i.map(n).sortBy(r).value()},mapLinks=function(e,t){var n=function(e){var t={};return mapItem(e,t,template.edgeMaps),t},r=function(e){return e.source+":"+e.target},i=_.chain(e);template.edgeFilters&&(i=i.filter(filterItem(template.edgeFilters))),t.links=i.map(n).sortBy(r).value()};return function(e,t){var n={};return n.configuration=t,template.configuration&&(template.configuration.legend&&(n.configuration.legend=template.configuration.legend),template.configuration.settings&&(n.configuration.settings=template.configuration.settings),template.configuration.selectionHops&&(n.configuration.selectionHops=template.configuration.selectionHops),template.configuration.selectionIdList&&(n.configuration.selectionIdList=template.configuration.selectionIdList)),e&&e.resources&&(mapNodes(e.resources,n),e.relations&&mapLinks(e.relations,n)),n}}